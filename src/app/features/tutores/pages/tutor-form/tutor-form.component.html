<div class="tutor-form">
  <div class="tutor-form__container">
    <app-form-header
      [title]="isEditMode ? 'Editar Tutor' : 'Novo Tutor'"
      [subtitle]="
        isEditMode
          ? 'Atualize as informações do tutor'
          : 'Adicione um novo tutor ao sistema'
      "
      [icon]="'person'"
      [showBackButton]="true"
      (backClick)="onBack()"
    >
    </app-form-header>

    <form
      [formGroup]="tutorForm"
      (ngSubmit)="onSubmit()"
      class="tutor-form__form"
    >
      <app-photo-upload
        [title]="'Foto do Tutor'"
        [icon]="'person'"
        [previewUrl]="previewUrl"
        [currentPhotoUrl]="currentPhotoUrl"
        [isEditMode]="isEditMode"
        [selectedFile]="selectedFile"
        (fileSelected)="onFileSelected($event)"
        (photoRemoved)="removePhoto()"
      >
      </app-photo-upload>

      <mat-card class="tutor-form__card tutor-form__info-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>info</mat-icon>
            Informações do Tutor
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="tutor-form__fields">
            <mat-form-field
              appearance="outline"
              class="tutor-form__field tutor-form__field--full"
            >
              <mat-label>Nome Completo</mat-label>
              <input
                matInput
                formControlName="nome"
                placeholder="Digite o nome completo"
              />
              <mat-icon matPrefix>person</mat-icon>
              <mat-error matErrorMessages></mat-error>
            </mat-form-field>

            <mat-form-field
              appearance="outline"
              class="tutor-form__field tutor-form__field--full"
            >
              <mat-label>Email</mat-label>
              <input
                matInput
                type="email"
                formControlName="email"
                placeholder="Digite o email"
              />
              <mat-icon matPrefix>email</mat-icon>
              <mat-error matErrorMessages></mat-error>
            </mat-form-field>

            <div class="tutor-form__fields-row">
              <mat-form-field appearance="outline" class="tutor-form__field">
                <mat-label>CPF</mat-label>
                <input
                  matInput
                  formControlName="cpf"
                  placeholder="000.000.000-00"
                  appMask="cpf"
                />
                <mat-icon matPrefix>badge</mat-icon>
                <mat-error matErrorMessages></mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="tutor-form__field">
                <mat-label>Telefone</mat-label>
                <input
                  matInput
                  formControlName="telefone"
                  placeholder="(00) 00000-0000"
                  appMask="telefone"
                />
                <mat-icon matPrefix>phone</mat-icon>
                <mat-error matErrorMessages></mat-error>
              </mat-form-field>
            </div>

            <mat-form-field
              appearance="outline"
              class="tutor-form__field tutor-form__field--full"
            >
              <mat-label>Endereço</mat-label>
              <input
                matInput
                formControlName="endereco"
                placeholder="Digite o endereço completo"
              />
              <mat-icon matPrefix>location_on</mat-icon>
              <mat-error matErrorMessages></mat-error>
            </mat-form-field>

            <app-form-actions
              [isEditMode]="isEditMode"
              [formInvalid]="tutorForm.invalid"
              (cancel)="onBack()"
              (delete)="onDelete()"
            ></app-form-actions>
          </div>
        </mat-card-content>
      </mat-card>
    </form>

    @if (isEditMode && tutorId) {
      <app-pet-link [tutorId]="tutorId"></app-pet-link>
    } @else {
      <mat-card class="tutor-form__pet-notice">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>pets</mat-icon>
            Vinculação de Pets
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <p>
            A opção de vincular pets ao tutor será liberada após a criação e
            salvamento do registro. Isso garante que o tutor esteja devidamente
            cadastrado antes de associar animais.
          </p>
        </mat-card-content>
      </mat-card>
    }
  </div>
</div>
